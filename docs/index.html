<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Home</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Home</h1>

    



    


    <h3> </h3>










    




    <section>
        <article><h1 id="onion-config-layer-based-config-data-manager">onion-config: layer-based config/data manager</h1>
<p>Provides object storage with layers overlapping and dynamic update support.</p>
<h2 id="usage">Usage</h2>
<pre class="prettyprint source"><code>npm install --save onion-config</code></pre><pre class="prettyprint source lang-javascript"><code>const Onion = require('onion-config');

const onion = new Onion();
// ENV contains value like some_foo = '{bar: 12345}'
await onion.addLayer(new Onion.LAYERS.Env({ prefix: 'some_', json: true, }));
onion.get('foo.bar'); // => '12345'

await onion.addLayer(new Onion.LAYERS.SimpleObject({
  data: {
    foo: {
        bar: 'baz'
      },
  },
}));
onion.get('foo.bar') // => 'baz'
</code></pre><h2 id="idea-of-layers">Idea of layers</h2>
<p>Every next added layer merges over previous just in moment of build, on first access (<code>.get()</code>) or<br>on explicit build call (<code>.compile</code>, <code>.recompile()</code>).</p>
<p>Value <code>.get()</code> method uses path notation like <code>some.thing.here</code> to access inner parts of stored data. After building<br><code>.get()</code> works just with merged <code>.data</code> object until next <code>.recompile()</code> call.</p>
<h3 id="links">Links</h3>
<p>To reuse big parts of your configs, you can use links. Just add value with path to other key, prefixed with <code>@</code>:</p>
<pre class="prettyprint source lang-javascript"><code>const onion = new Onion({ links: true });
await onion.addLayer(new Onion.LAYERS.SimpleObject({
  data: {
    resources: {
      databases: {
        MySQL: {
          host: 'localhost',
        },
      },
    },
    services: {
      login: '@resources.databases.MySQL',
    },
  }
}));
onion.get('services.login') // => { 'host': 'localhost' }</code></pre><h2 id="supported-config-sources-layers-">Supported config sources (Layers)</h2>
<h3 id="simple-object">Simple object</h3>
<p>In-code storage, not recommended. Just keeps data from given <code>data</code> option.</p>
<pre class="prettyprint source lang-javascript"><code>await onion.addLayer(new Onion.LAYERS.SimpleObject({
  data: {
    foo: {
      bar: 12345
    },
  },
}));
onion.get('foo.bar') // => 12345</code></pre><h3 id="env-parser">Env parser</h3>
<p>It parses environment variables, filtering it by <code>prefix</code> and supports JSON-serialized values if <code>json</code> option is <code>true</code>.<br>In addition, possible to change parsing with <code>parsingSeparator</code> option.</p>
<p><strong>Warning</strong>: <code>prefix</code> option is just a filter for keys while parsing and it will not appear in the parsing results!</p>
<pre class="prettyprint source lang-javascript"><code>await onion.addLayer(new Onion.LAYERS.Env({ prefix: 'some_', json: true, }));</code></pre><h3 id="hashicorp-vault-kv2-storage">Hashicorp Vault KV2 storage</h3>
<p>HashiCorp Vault layer, now just with <code>kv2</code> engine support.<br>Loads all keys in <code>basePath</code> and stores it. Useful for micro services. Keys version support in process.<br>If <code>renewInterval</code> set above 0, then layer will renew token TTL above <code>minTtl</code> value periodically (every <code>renewInterval</code><br>seconds)</p>
<pre class="prettyprint source lang-javascript"><code>await onion.addLayer(new Onion.LAYERS.Vault({
  url: env.VAULT_URL,
  token: env.VAULT_TOKEN,
  basePath,
  renewInterval: 0,
  minTtl: 7200,
}));</code></pre><h3 id="full-api-docs-is-here">Full API docs is <a href="https://smbc1.github.io/onion-config/">here</a></h3></article>
    </section>






</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AbstractLayer.html">AbstractLayer</a></li><li><a href="EnvLayer.html">EnvLayer</a></li><li><a href="Kv2.html">Kv2</a></li><li><a href="Onion.html">Onion</a></li><li><a href="SimpleObjectLayer.html">SimpleObjectLayer</a></li><li><a href="VaultLayer.html">VaultLayer</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Apr 11 2019 17:30:00 GMT+0300 (MSK)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>